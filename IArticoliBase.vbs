'NOCACHE

'----------------------------------------------------------
'Lista Campi Interattore ( nome [ label ] { tipo } )
'----------------------------------------------------------

' desLookupTipoNotaG [  ]  { CEditControl }
' desLookupTipologiaContratto [  ]  { CEditControl }
' lblLookupTazi [  ]  { CLinkControl }
' ButtonMultilinguaDesc [  ]  { CButtonExecuteControl }
' ButtonRepPrezzoAcq [  ]  { CButtonExecuteControl }
' ArtbCCodEsterno [ Cod.Applicativo Est. ]  { CEditControl }
' artbQLottMax [ Lotto Massimo ]  { CCurrencyEditControl }
' ArtbCSerPrprQLivRiord [ Liv. di Riord. ]  { CCurrencyEditControl }
' DElco [ Elab. Kanban ]  { CEditControl }
' lblLookupTipoArticolo [  ]  { CLinkControl }
' lblLookupUMQtaMinVen [  ]  { CLinkControl }
' artbQLottMin [ Lotto Minimo ]  { CCurrencyEditControl }
' LookupGrAttr [ Gruppo Attributi ]  { CLookupControl }
' artbFPeriFatt [ Periodicita' Fatt. ]  { CComboBoxControl }
' ArtbCSerPrprFSalcLTime [ Calcolo ]  { CComboBoxControl }
' ArtbNonScontabile [ Non Scontabile ]  { CCheckBoxControl }
' lblLookupUnitaMisura [  ]  { CLinkControl }
' LookupTazi [ Azienda ]  { CLookupControl }
' BtnCopCanone [  ]  { CButtonExecuteControl }
' lblLookupModCalcCons [  ]  { CLinkControl }
' artbFModaFatt [ Modalita' Fatt. ]  { CComboBoxControl }
' artbFCopScortaCSer [  ]  { CComboBoxControl }
' ArtbNCopCanone [ Copertura Canone ]  { CIntEditControl }
' ArtbCalcFinCnt [ Orizzonte Contratto ]  { CIntEditControl }
' desLookupTipoApp [  ]  { CEditControl }
' artbQconPer [ C. Totale ]  { CCurrencyEditControl }
' ButtonMultilinguaNotaL [  ]  { CButtonExecuteControl }
' desLookupNeutro [  ]  { CEditControl }
' ArtbQConMgMax [ Cons.Medio gg Max ]  { CCurrencyEditControl }
' desLookupColore [  ]  { CEditControl }
' ButtonMultilinguaNotaG [  ]  { CButtonExecuteControl }
' ButtonComposizione [  ]  { CButtonExecuteControl }
' ArtbQtaMaxMake [ Max Make ]  { CCurrencyEditControl }
' ButtonMultilinguaNotaR [  ]  { CButtonExecuteControl }
' ArtbNKanban [ N. Kanban ]  { CIntEditControl }
' artbFScaglioni [ A Scaglioni ]  { CCheckBoxControl }
' desLookupImballi2 [  ]  { CEditControl }
' ButtonDisponib [  ]  { CButtonExecuteControl }
' ButtonMovimenti [  ]  { CButtonExecuteControl }
' ArtbDArtb [ Descrizione Articolo ]  { CEditControl }
' artbNggPeriodo [ GG. Totali ]  { CCurrencyEditControl }
' desLookupUnitaMisura [  ]  { CEditControl }
' lblLookupTipologiaContratto [  ]  { CLinkControl }
' ArtbQtaMaxBuy [ Max Buy ]  { CCurrencyEditControl }
' LookupImballi [ Flusso Attivo ]  { CLookupControl }
' desLookupTazi [  ]  { CEditControl }
' artbPrzForfait [ A Forfait ]  { CCheckBoxControl }
' ButtonCopia [  ]  { CButtonExecuteControl }
' lblLookupTipoApp [  ]  { CLinkControl }
' artbTdataIniPer [ Dal ]  { CDateTimeControl }
' ButtonMultilinguaComm [  ]  { CButtonExecuteControl }
' artbTdataCalCon [ Al ]  { CDateTimeControl }
' ArtbQconMg [ C. Giorn. ]  { CCurrencyEditControl }
' lblLookupImballi2 [  ]  { CLinkControl }
' artbNPzColloAt [ Coeff. ]  { CCurrencyEditControl }
' desLookupImballi [  ]  { CEditControl }
' desLookupKanCo [  ]  { CEditControl }
' ArtbGioAcco [ Giorni Orizzonte Nettificazione ]  { CIntEditControl }
' BtnCalcFinCnt [  ]  { CButtonExecuteControl }
' LookupNeutro [ Neutro di Rif. ]  { CLookupControl }
' ArtbFNeutroCSer [ Neutro/Conf. ]  { CComboBoxControl }
' ArtbDArtbComm [ Descrizione Commerciale ]  { CEditControl }
' ArtbCSerPrprQLottoRif [ Lotto Rif. ]  { CCurrencyEditControl }
' artbNgscad [ Giorni Scadenza ]  { CIntEditControl }
' LookupTGLM [ Tipo Gestione ]  { CLookupControl }
' LookupTipoNotaL [ Tipo Nota ]  { CLookupControl }
' LookupTipoNotaG [ Tipo Nota ]  { CLookupControl }
' artbQtaVenLotto [ Lotto di vendita ]  { CCurrencyEditControl }
' ArtbBonus [ Bonus Servizio (UM Documento) ]  { CCurrencyEditControl }
' ArtbCSerPrprQScortaMin [ Scorta Minima ]  { CCurrencyEditControl }
' ButtonGiacenze [  ]  { CButtonExecuteControl }
' LookupUnitaMisura [ U.M. Logistica ]  { CLookupControl }
' lblLookupTipoUtil [  ]  { CLinkControl }
' LookupTipologiaContratto [ Tipologia Contratto ]  { CLookupControl }
' LookupTipoApp [ Tipo Approvv. ]  { CLookupControl }
' LookupTipoNotaR [ Tipo Nota ]  { CLookupControl }
' artbDisablerate [ No Rate ]  { CCheckBoxControl }
' ArtbQconMPer [ C. Periodo ]  { CCurrencyEditControl }
' NotaL [ Nota ]  { CEditControl }
' ArtbCSerPrprQLottoRiord [ Lotto Riordino ]  { CCurrencyEditControl }
' artbFCopLottoCSer [  ]  { CComboBoxControl }
' NotaG [ Nota ]  { CEditControl }
' artbNCopLotto [ Cop.Lot. ]  { CCurrencyEditControl }
' LookupTipoCop [ Tipo Copertura ]  { CLookupControl }
' ArtbCSerPrprNLeadTime [ Lead Time ]  { CIntEditControl }
' LookupUMQtaMinVen [ U.M. ]  { CLookupControl }
' ArtbCArtb [ Codice Articolo ]  { CEditControl }
' NotaR [ Nota ]  { CEditControl }
' LookupKanCo [ Contenitore per Kanban ]  { CLookupControl }
' lblLookupTipoNotaL [  ]  { CLinkControl }
' desLookupTipoUtil [  ]  { CEditControl }
' LookupImballi2 [ Flusso Passivo ]  { CLookupControl }
' LookupTipoArticolo [ Tipo Articolo ]  { CLookupControl }
' lblLookupTipoNotaG [  ]  { CLinkControl }
' desLookupTipoArticolo [  ]  { CEditControl }
' ArtbCSerPrprFSalcRiord [ Calcolo ]  { CComboBoxControl }
' lblLookupTipoNotaR [  ]  { CLinkControl }
' ArtbCCodComm [ Codice Commerciale ]  { CEditControl }
' lblLookupColore [  ]  { CLinkControl }
' BtnCalcEndFatt [  ]  { CButtonExecuteControl }
' LookupColore [ Colore ]  { CLookupControl }
' desLookupTipoCop [  ]  { CEditControl }
' desLookupUMQtaMinVen [  ]  { CEditControl }
' ButtonRepPrezzoVen [  ]  { CButtonExecuteControl }
' LookupSostituto [ Art. sostitutivo ]  { CLookupControl }
' artbNCopScorta [ Cop.Sc. ]  { CCurrencyEditControl }
' desLookupTGLM [  ]  { CEditControl }
' lblLookupKanCo [  ]  { CLinkControl }
' ArtbCalcCntEnd [ Orizzonte Fatturaz. ]  { CIntEditControl }
' artbNPzColloPa [ Coeff. ]  { CCurrencyEditControl }
' desLookupGrAttr [  ]  { CEditControl }
' lblLookupGrAttr [  ]  { CLinkControl }
' ArtbQtaMinVen [ Qta minima di vendita ]  { CCurrencyEditControl }
' lblLookupImballi [  ]  { CLinkControl }
' LookupModCalcCons [ Mod. ]  { CLookupControl }
' GroupBox2 [  ]  { CFrameControl }
' LookupTipoUtil [ Tipo Utilizzo ]  { CLookupControl }
' GroupBox5 [  ]  { CFrameControl }
' GroupBox6 [  ]  { CFrameControl }
' GroupBox7 [  ]  { CFrameControl }
' GroupBox8 [  ]  { CFrameControl }
' GroupBox9 [  ]  { CFrameControl }
' artbGeneraFoSer [ Genera Fornitura Servizio ]  { CCheckBoxControl }
' lblLookupTipoCop [  ]  { CLinkControl }
' desLookupTipoNotaR [  ]  { CEditControl }
' ArtbTdataObs [ Data Obsolesc. ]  { CDateTimeControl }
' ArtbBonusXmatr [ X Matr ]  { CCheckBoxControl }
' lblLookupTGLM [  ]  { CLinkControl }
' artbGeneraGRMat [ Genera Gruppo Matricole ]  { CCheckBoxControl }
' artbFAbilConsCSer [ Consumi ]  { CComboBoxControl }
' codLookupGrAttr [ Gruppo Attributi ]  { CEditControl }
' buttLookupGrAttr [  ]  { CButtonExecuteControl }
' codLookupTazi [ Azienda ]  { CEditControl }
' buttLookupTazi [  ]  { CButtonExecuteControl }
' codLookupImballi [ Flusso Attivo ]  { CEditControl }
' buttLookupImballi [  ]  { CButtonExecuteControl }
' codLookupNeutro [ Neutro di Rif. ]  { CEditControl }
' buttLookupNeutro [  ]  { CButtonExecuteControl }
' codLookupTGLM [ Tipo Gestione ]  { CEditControl }
' buttLookupTGLM [  ]  { CButtonExecuteControl }
' codLookupTipoNotaL [ Tipo Nota ]  { CEditControl }
' buttLookupTipoNotaL [  ]  { CButtonExecuteControl }
' codLookupTipoNotaG [ Tipo Nota ]  { CEditControl }
' buttLookupTipoNotaG [  ]  { CButtonExecuteControl }
' codLookupUnitaMisura [ U.M. Logistica ]  { CEditControl }
' buttLookupUnitaMisura [  ]  { CButtonExecuteControl }
' codLookupTipologiaContratto [ Tipologia Contratto ]  { CEditControl }
' buttLookupTipologiaContratto [  ]  { CButtonExecuteControl }
' codLookupTipoApp [ Tipo Approvv. ]  { CEditControl }
' buttLookupTipoApp [  ]  { CButtonExecuteControl }
' codLookupTipoNotaR [ Tipo Nota ]  { CEditControl }
' buttLookupTipoNotaR [  ]  { CButtonExecuteControl }
' codLookupTipoCop [ Tipo Copertura ]  { CEditControl }
' buttLookupTipoCop [  ]  { CButtonExecuteControl }
' codLookupUMQtaMinVen [ U.M. ]  { CEditControl }
' buttLookupUMQtaMinVen [  ]  { CButtonExecuteControl }
' codLookupKanCo [ Contenitore per Kanban ]  { CEditControl }
' buttLookupKanCo [  ]  { CButtonExecuteControl }
' codLookupImballi2 [ Flusso Passivo ]  { CEditControl }
' buttLookupImballi2 [  ]  { CButtonExecuteControl }
' codLookupTipoArticolo [ Tipo Articolo ]  { CEditControl }
' buttLookupTipoArticolo [  ]  { CButtonExecuteControl }
' codLookupColore [ Colore ]  { CEditControl }
' buttLookupColore [  ]  { CButtonExecuteControl }
' codLookupSostituto [ Art. sostitutivo ]  { CEditControl }
' buttLookupSostituto [  ]  { CButtonExecuteControl }
' codLookupModCalcCons [ Mod. ]  { CEditControl }
' buttLookupModCalcCons [  ]  { CButtonExecuteControl }
' codLookupTipoUtil [ Tipo Utilizzo ]  { CEditControl }
' buttLookupTipoUtil [  ]  { CButtonExecuteControl }
' ArtbCSer [  ]  { Interger }
' ArtbCopia [  ]  { Interger }
' ArticoloNeutro [  ]  { String }
' ArtbWCodConf [  ]  { String }
' codLookupGrCosti [  ]  { String }
' desLookupGrCosti [  ]  { String }
' codLookupAliquoteIVA [  ]  { String }
' desLookupAliquoteIVA [  ]  { String }
' codLookupNomenclature [  ]  { String }
' desLookupNomenclature [  ]  { String }
' codLookupContropartiteArt [  ]  { String }
' desLookupContropartiteArt [  ]  { String }
' codLookupArticoloBdg [  ]  { String }
' desLookupArticoloBdg [  ]  { String }
' desLookupModCalcCons [  ]  { String }
' desLookupSostituto [  ]  { String }
' codLookupArticoloMPS [  ]  { String }
' desLookupArticoloMPS [  ]  { String }
' ArtbFNeutro [  ]  { String }
' ArtbCRNeutro [  ]  { Interger }
' ArtbCRTabc [  ]  { Interger }
' ArtbFNeutroD [  ]  { Object }
' ArtbCRTazi [  ]  { Interger }
' ArtbCSerTums [  ]  { Interger }
' ArtbCSerTpar [  ]  { Interger }
' SerTipoNotaG [  ]  { Interger }
' ArtbCRTgaa [  ]  { Interger }
' SerNotaG [  ]  { Interger }
' ArtbCSerTpcp [  ]  { Interger }
' ArtbCSerTpap [  ]  { Interger }
' ArtbCSerTput [  ]  { Interger }
' ArtbCSerTimbAt [  ]  { Interger }
' ArtbCSerTimbPa [  ]  { Interger }
' ArtbCSerTglm [  ]  { Interger }
' Descalclead1 [  ]  { Object }
' ArtbCSerPrprFCalcLTime [  ]  { String }
' Descalcriord1 [  ]  { Object }
' ArtbCSerPrprFCalcRiord [  ]  { Object }
' DesFCopLotto [  ]  { Object }
' artbFCopLottoCAzione [  ]  { String }
' DesFCopScorta [  ]  { Object }
' artbFCopScortaCAzione [  ]  { String }
' DesFAbilCons [  ]  { Object }
' artbFAbilConsCAzione [  ]  { String }
' ArtbCRMccon [  ]  { Interger }
' ArtbCRSostCons [  ]  { Interger }
' SerTipoNotaL [  ]  { Interger }
' desLookupTipoNotaL [  ]  { String }
' SerNotaL [  ]  { Interger }
' ArtbCSerTali [  ]  { Interger }
' ArtbCSerTncc [  ]  { Interger }
' artbNCoeffConvIntra [  ]  { Double }
' artbNCoeffConvIntraGest [  ]  { Double }
' ArtbCSerTcca [  ]  { Interger }
' ArtbCRArtbBdg [  ]  { Interger }
' SerTipoNotaC [  ]  { Interger }
' codLookupTipoNotaC [  ]  { String }
' desLookupTipoNotaC [  ]  { String }
' NotaC [  ]  { String }
' SerNotaC [  ]  { Interger }
' ButtonMultilinguaNotaC [  ]  { String }
' SerTipoNotaT [  ]  { Interger }
' codLookupTipoNotaT [  ]  { String }
' desLookupTipoNotaT [  ]  { String }
' NotaT [  ]  { String }
' SerNotaT [  ]  { Interger }
' ButtonMultilinguaNotaT [  ]  { String }
' SerTipoNotaR [  ]  { Interger }
' SerNotaR [  ]  { Interger }
' ArtbCRTumsQtaMinVen [  ]  { Interger }
' artbFPeriFattCAzione [  ]  { String }
' artbFPeriFattCSer [  ]  { Interger }
' artbFModaFattCAzione [  ]  { String }
' artbFModaFattCSer [  ]  { Interger }
' ArtbCRTpCon [  ]  { Interger }
' ArtbCSerTgca [  ]  { Interger }
' ArtbNlotcalcost [  ]  { Double }
' ArtbCRElco [  ]  { Interger }
' ArtbCRKanco [  ]  { Interger }
' artbChkMPS [  ]  { Boolean }
' artbFCoperturaCSer [  ]  { Object }
' DesFCopertura [  ]  { Object }
' artbFCoperturaCAzione [  ]  { String }
' artbChkFitt [  ]  { Boolean }
' artbCRArtbMPS [  ]  { Interger }
' artbMPSQuotaCons [  ]  { Double }




'----------------------------------------------------------
NomeInterattore = "IArticoliBase"
'----------------------------------------------------------


'Function OnQueryInitialize()
'	On Error Resume Next
'	OnQueryInitialize=0
'	MsgBox(NomeInterattore & ".OnQueryInitialize")

'End Function


'Function OnInitialize()
'	On Error Resume Next
'	OnInitialize=0
'	MsgBox(NomeInterattore & ".OnInitialize")

'End Function


'Function OnLostFocus(Nome)
'	On Error Resume Next
'	OnLostFocus=0
''	Non usare MsgBox in quanto toglie il focus al campo di arrivo
''	MsgBox(NomeInterattore & ".OnLostFocus(" & Nome & ")")

'End Function


'Function OnQueryChange(Nome,Valore)
'	On Error Resume Next
'	OnQueryChange=0
'	MsgBox(NomeInterattore & ".OnQueryChange(" & Nome & "," & Valore & ")")

'End Function


Function OnChange(Nome,Valore)
	'On Error Resume Next
	OnChange=0
	'MsgBox(NomeInterattore & ".OnChange(" & Nome & "," & Valore & ")")
	
	If ucase(Nome) = ucase("EndCopyArt" ) Then
	'MsgBox(NomeInterattore & "dentro EndCopyArt")
		call this.SetLookupValues ("LookupColore",0,0)
		call this.SetLookupValues ("LookupNomenclature",0,0)
		
		call this.ChangeTab("S_ARTICOLI_BASE_T",3)
		Dim oColRighe
		Dim oInt
		Dim riga
		Dim stat
		Dim Nr
		Err.Clear
		REM 'ATTRIBUTI TECNICI
		REM Set oInt = this.GetApplication().GetInteractor("IRArticoliAttributiT")
		REM Set oColRighe = oInt.GetCollection()
		
		REM If Err> 0 Then Msgbox("ERRORE  IRArticoliAttributiT " & Err.Description)  
		
		REM If Err.Number = 0 Then
			REM Set FirstRow = oInt.GetCurrentRow()
			REM CurrRow = -1
			REM stat = oColRighe.GetFirst()
			REM 'ciclo interno sulle righe 

			REM While stat
				REM CurrRow = CurrRow + 1
				REM Call oInt.SetCurrentRow(CurrRow)
				REM on error resume next
				REM 'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				REM 'msgbox ("ATTR " & oInt.GetValue("codLookupAttr") )
				REM 'Numerici
				REM if  UCASE(oInt.GetValue("codLookupAttr"))  = UCASE("PEN")  then
					REM call oInt.ChangeValue ("ArtaNValAtt",0)
				REM end if
				REM if  UCASE(oInt.GetValue("codLookupAttr"))  = UCASE("PEL")  then
					REM call oInt.ChangeValue ("ArtaNValAtt",0)
				REM end if
				
				REM stat = oColRighe.GetNext()
			REM Wend
			REM Set oColRighe=Nothing
			REM Call oInt.SetCurrentRow(FirstRow)
		REM end if
		REM Err.Clear
	
		REM 'BARCODE
		REM Set oInt = this.GetApplication().GetInteractor("IRArticoliBarcode")
		REM Set oColRighe = oInt.GetCollection()
		
		REM If Err> 0 Then Msgbox("ERRORE  IRArticoliBarcode " & Err.Description)  
		
		REM If Err.Number = 0 Then
			REM stat = oColRighe.GetFirst()
			REM 'ciclo interno sulle righe 
			REM While stat
				REM Call oInt.Drop ()
				REM on error resume next
				REM 'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				REM stat = oColRighe.GetFirst()
			REM Wend
			REM Set oColRighe=Nothing
		REM end if
		
		REM 'OGGETTI
		REM Set oInt = this.GetApplication().GetInteractor("IROggetti")
		REM Set oColRighe = oInt.GetCollection()
		
		REM If Err> 0 Then Msgbox("ERRORE  IROggetti " & Err.Description)  
		
		REM If Err.Number = 0 Then
			REM stat = oColRighe.GetFirst()
			REM 'ciclo interno sulle righe 
			REM While stat
				REM Call oInt.Drop ()
				REM on error resume next
				REM 'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				REM stat = oColRighe.GetFirst()
			REM Wend
			REM Set oColRighe=Nothing
		REM end if
		
		REM 'FORNITORE
		REM Set oInt = this.GetApplication().GetInteractor("IRArticoliFornitori")
		REM Set oColRighe = oInt.GetCollection()
		
		REM If Err> 0 Then Msgbox("ERRORE  IRArticoliFornitori " & Err.Description)  
		
		REM If Err.Number = 0 Then
			REM stat = oColRighe.GetFirst()
			REM 'ciclo interno sulle righe 
			REM While stat
				REM Call oInt.Drop ()
				REM on error resume next
				REM 'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				REM stat = oColRighe.GetFirst()
			REM Wend
			REM Set oColRighe=Nothing
		REM end if
	
		'LISTINO ACQUISTI /VENDITE
		Set oInt = this.GetApplication().GetInteractor("IRListiniAcquisti")
		Set oColRighe = oInt.GetCollection()
		
		If Err> 0 Then Msgbox("ERRORE  IRListiniAcquisti " & Err.Description)  
		
		If Err.Number = 0 Then
			stat = oColRighe.GetFirst()
			'ciclo interno sulle righe 
			While stat
				Call oInt.Drop ()
				on error resume next
				'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				stat = oColRighe.GetFirst()
			Wend
			Set oColRighe=Nothing
		end if
	
		
		Set oInt = this.GetApplication().GetInteractor("IRListiniVendita")
		Set oColRighe = oInt.GetCollection()
		
		If Err> 0 Then Msgbox("ERRORE IRListiniVendita " & Err.Description)  
		
		If Err.Number = 0 Then
			stat = oColRighe.GetFirst()
			'ciclo interno sulle righe 
			While stat
				Call oInt.Drop ()
				on error resume next
				'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				stat = oColRighe.GetFirst()
			Wend
			Set oColRighe=Nothing
		end if
		
		'SCONTI ACQUISTI /VENDITE
		Set oInt = this.GetApplication().GetInteractor("IRScontiAcquisti")
		Set oColRighe = oInt.GetCollection()
		
		If Err> 0 Then Msgbox("ERRORE  IRScontiAcquisti " & Err.Description)  
		
		If Err.Number = 0 Then
			stat = oColRighe.GetFirst()
			'ciclo interno sulle righe 
			While stat
				Call oInt.Drop ()
				on error resume next
				'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				stat = oColRighe.GetFirst()
			Wend
			Set oColRighe=Nothing
		end if
	
		Set oInt = this.GetApplication().GetInteractor("IRScontiVendita")
		Set oColRighe = oInt.GetCollection()
		
		If Err> 0 Then Msgbox("ERRORE IRScontiVendita " & Err.Description)  
		
		If Err.Number = 0 Then
			stat = oColRighe.GetFirst()
			'ciclo interno sulle righe 
			While stat
				Call oInt.Drop ()
				on error resume next
				'Questa sezione serve per impostare il fornitore preferenziale dell'articolo e di riportarlo nella riga dei documenti
				stat = oColRighe.GetFirst()
			Wend
			Set oColRighe=Nothing
		end if		


'		'Oggetti IROggetti
'		Err.Clear
'		Set oInt = this.GetApplication().GetInteractor("IROggetti")
'		Set oColRighe = oInt.GetCollection()
'		
'		If Err> 0 Then Msgbox("ERRORE  IROggetti " & Err.Description)  
'		
'		If Err.Number = 0 Then
'			stat = oColRighe.GetFirst()
'			'ciclo interno sulle righe 
'			While stat
'				Set riga=oColRighe.GetCurrent()
'				on error resume next
'				ValOgg =  ""
'				call oInt.ChangeValue("ArtoDPathOgg",ValOgg)
'				'call riga.SetValue ("ArtaCSerVlat",4)
'				Set riga =Nothing
'				stat = oColRighe.GetNext()
'			Wend
'			Set oColRighe=Nothing
'		end if

		
	end if

End Function



'Function OnQueryDrop()
'	On Error Resume Next
'	OnQueryDrop=0
'	MsgBox(NomeInterattore & ".OnQueryDrop")

'End Function


'Function OnDrop()
'	On Error Resume Next
'	OnDrop=0
'	MsgBox(NomeInterattore & ".OnDrop")

'End Function


'Function OnQueryNew()
'	On Error Resume Next
'	OnQueryNew=0
'	MsgBox(NomeInterattore & ".OnQueryNew")

'End Function


'Function OnNew()
'	On Error Resume Next
'	OnNew=0

'	MsgBox(NomeInterattore & ".OnNew")

'End Function


'Function OnAfterNew()
'	On Error Resume Next
'	OnAfterNew=0

'	MsgBox(NomeInterattore & ".OnAfterNew")

'End Function


'Function OnQueryMove()
'	On Error Resume Next
'	OnQueryMove=0

'	MsgBox(NomeInterattore & ".OnQueryMove")

'End Function


'Function OnMove()
'	On Error Resume Next
'	OnMove=0

'	MsgBox(NomeInterattore & ".OnMove")

'End Function

'enrico 27/06/22 CIT202200296 - DATA INSERIMENTO PRODOTTO
Function OnQuerySave()
	On Error Resume Next
	OnQuerySave=0
	
	if (this.GetCollection().GetCurrent().status = 3) then
		Call caricaDataIns(this.GetValue("ArtbCSer"))
	else
		Call cambioTipoArticoloDaOld(this.GetValue("ArtbCSer"))
	end if
End Function

'enrico 27/06/22 CIT202200296 - DATA INSERIMENTO PRODOTTO
Function cambioTipoArticoloDaOld(SerialeArticolo)
	Dim conn : Set conn = CreateObject("ADODB.Connection")
	conn.Open globals.GetEnvironment("DsnAPP"),"grupposga","agsoppurg"
	
	'Creazione oggetto comando
	Dim rs:	Set rs = CreateObject("ADODB.RecordSet")
	rs.CursorType = 0 'adOpenForwardOnly
	rs.LockType = 1 'adLockReadOnly
	
	Dim strSQL : strSQL = "SELECT TparCTpar FROM ArticoliBase WITH (NOLOCK) INNER JOIN TabTipoArticolo ON tparCRTabc = artbCRtabc WHERE ArtbCSer = " & SerialeArticolo
	
	Call rs.Open(strSQL, conn)	
	if not rs.Eof then
		rs.MoveFirst()
		Dim tipoArt
		tipoArt = rs("TparCTpar")
		if(StrComp(tipoArt, this.GetValue("codLookupTipoArticolo"), vbTextCompar) <> 0 AND (StrComp(tipoArt, "OLD", vbTextCompar) = 0 OR StrComp(tipoArt, "OLD-R", vbTextCompar) = 0)) then
			Call caricaDataIns(SerialeArticolo)
		end if
	end if
			
	Set rs = Nothing
	Call conn.Close()
	Set conn = Nothing
End Function

'enrico 27/06/22 CIT202200296 - DATA INSERIMENTO PRODOTTO
Function caricaDataIns(SerialeArticolo)
	'Creazione connessione con Database UP
	Dim conn
	Set conn = CreateObject("ADODB.Connection")
	conn.Open globals.GetEnvironment("DsnAPP"),"grupposga","agsoppurg"
	
	'Creazione oggetto comando
	Dim nIdSdi
	Dim oCmd
	Set oCmd = CreateObject("ADODB.Command")

	'Creazione comando con Stored Procedure
	Set oCmd.ActiveConnection = conn
	oCmd.CommandType = 4		'Stored Procedures
	oCmd.CommandText = "ITsp_AggiungiDataInserimentoProdotto"

	'Specifica parametro di input
	oCmd.Parameters.Refresh
	oCmd.Parameters(1).Value = SerialeArticolo
	
	'Esecuzione del comando
	oCmd.Execute()

	'Chiusura connessione e comando
	Set oCmd = Nothing
	conn.Close
	Set conn = Nothing
End Function


Function OnCommand(Nome)
	On Error Resume Next

	OnCommand=0
	'MsgBox(NomeInterattore & ".onCommand " & Nome)
	IF UCASE(NOME) = "BTNAGGIORNAKITCOLLEGATI" THEN
		Dim SerComponente
		SerComponente = this.GetValue("ArtbCSer")
	
		Dim connection: Set connection = CreateObject("ADODB.Connection")		
		connection.Open  globals.GetEnvironment("DSNAPP"), "grupposga","agsoppurg"
			
		Dim rs:	Set rs = CreateObject("ADODB.RecordSet")
		rs.CursorType = 0 'adOpenForwardOnly
		rs.LockType = 1 'adLockReadOnly
						
		'calcolo il prezzo corrente del kit e recupero i dati (eventuali) dell'ultimo prezzo di listino memorizzato	
		Dim strSQL: strSQL = 	"SELECT DspcCSArtb" & _
					" FROM 	StrutturaComponente " & _
					" WHERE  DspcCSArtb = '" & SerComponente & "'"
			
		Call rs.Open( strSQL, connection )
			
		if not rs.Eof then
			rs.MoveFirst()
			Dim risposta
			risposta=msgbox ("Con questo comando verranno ricacolati i prezzi dei Kit collegati a questo articolo componente. Continuare?",vbQuestion+vbYesNo,"Aggiornamento prezzi kit")
			if risposta=vbYes then
				InsertPrezzoKit_COMP SerComponente
				msgbox "Operazione completata!",vbInformation,"Aggiornamento prezzi kit"
			else
				msgbox "Operazione annullata!",vbExclamation,"Aggiornamento prezzi kit"
			end if
			'
			
		else
			msgbox "Questo articolo non fa parte di nessun kit!",vbExclamation,"Aggiornamento prezzi kit"
		end if
							
		Set rs = Nothing
			
		Call connection.Close()
		Set connection = Nothing

	END IF

End Function


Function InsertPrezzoKit_COMP(SerComponente)

		Dim connI
		Set connI = CreateObject("ADODB.Connection")
		connI.Open globals.GetEnvironment("DSNAPP"),"grupposga","agsoppurg"
		
		Dim oCmdI
		Set oCmdI = CreateObject("ADODB.Command")

		Set oCmdI.ActiveConnection = connI
		oCmdI.CommandType = 4	'Stored Procedures
		oCmdI.CommandText = "ITsp_InserisciPrezzoKit_COMP"

		oCmdI.Parameters.Refresh
		
		oCmdI.Parameters(1).Value = SerComponente
		
		
		oCmdI.Execute()

		Set oCmdI = Nothing
		connI.Close
		Set connI = Nothing

End Function


'Function OnAfterSave()
'	On Error Resume Next
'	OnAfterSave=0

'	MsgBox(NomeInterattore & ".OnAfterSave")

'End Function


'Function OnQueryShowWindow(Nome,vParam)
'	On Error Resume Next
'	OnQueryShowWindow=0

'	Dim descr(3)
'	Parametri = NomeInterattore & ".OnQueryShowWindow" & "(" & Nome & ",vParam)" & Chr(13) & Chr(10)
'	descr(0) = "PARAMS_IN"
'	descr(1) = "IN_PARAMS"
'	descr(2) = "OUT_PARAMS"
'	for j=LBound(vParam) to UBound(vParam)
'		for i=LBound(vParam(j)) to UBound(vParam(j))
'			if (i = LBound(vParam(j))) then
'				Parametri = Parametri & "  " & descr(j) & Chr(13) & Chr(10)
'			end if
'			Parametri = Parametri &  "    " & "vParam(" & CStr(j) & ")(" & CStr(i) & ")=" & CStr(vParam(j)(i)) & Chr(13) & Chr(10)
'		next
'	next

''ATTENZIONE:
''Se si modificano i valori di vParam (ad es: vParam(0)(0) = "..."
''e' necessario inserire dopo le modifiche 
''	OnQueryShowWindow = vParam

'	MsgBox(Parametri)
'End Function


'Function OnShowWindow(Nome,vParam)
'	On Error Resume Next
'	OnShowWindow=0

'	Dim descr(3)
'	Parametri = NomeInterattore & ".OnShowWindow" & "(" & Nome & ",vParam)" & Chr(13) & Chr(10)
'	descr(0) = "PARAMS_IN"
'	descr(1) = "IN_PARAMS"
'	descr(2) = "OUT_PARAMS"
'	for j=LBound(vParam) to UBound(vParam)
'		for i=LBound(vParam(j)) to UBound(vParam(j))
'			if (i = LBound(vParam(j))) then
'				Parametri = Parametri & "  " & descr(j) & Chr(13) & Chr(10)
'			end if
'			Parametri = Parametri &  "    " & "vParam(" & CStr(j) & ")(" & CStr(i) & ")=" & CStr(vParam(j)(i)) & Chr(13) & Chr(10)
'		next
'	next

''ATTENZIONE:
''Se si modificano i valori di vParam (ad es: vParam(0)(0) = "..."
''e' necessario inserire dopo le modifiche 
''	OnShowWindow = vParam

'	MsgBox(Parametri)
'End Function


'Function OnQueryUpdateRow(controlName,rowIndex)
'	On Error Resume Next
'	OnQueryUpdateRow=0
'	MsgBox(NomeInterattore & ".OnQueryUpdateRow(" & controlName & "," & rowIndex & ")")

'End Function


'Function OnUpdateRow(controlName,rowIndex)
'	On Error Resume Next
'	OnUpdateRow=0
'	MsgBox(NomeInterattore & ".OnUpdateRow(" & controlName & "," & rowIndex & ")")

'End Function


'Function OnQueryRowsDrop(Nome,vBefore,vParam)
'	On Error Resume Next
'	OnQueryRowsDrop=0
'    Parametri = NomeInterattore & ".OnQueryRowsDrop " & "(" & Nome & "," & vBefore & ",vParam)" & Chr(13) & Chr(10)
'	for i=LBound(vParam) to UBound(vParam)
'	    Parametri = Parametri & "  " & vParam(i) & Chr(13) & Chr(10)
'	next
'	MsgBox(Parametri)
'End Function

'Function OnRowsDrop(Nome,vBefore,vParam)
'	On Error Resume Next
'	OnRowsDrop=0
'    Parametri = NomeInterattore & ".OnRowsDrop " & "(" & Nome & "," & vBefore & ",vParam)" & Chr(13) & Chr(10)
'	for i=LBound(vParam) to UBound(vParam)
'	    Parametri = Parametri & "  " & vParam(i) & Chr(13) & Chr(10)
'	next
'	MsgBox(Parametri)
'End Function

'Function OnQueryUndoRowsDrop(Nome,vBefore,vParam)
'	On Error Resume Next
'	OnQueryUndoRowsDrop=0
'    Parametri = NomeInterattore & ".OnQueryUndoRowsDrop " & "(" & Nome & "," & vBefore & ",vParam)" & Chr(13) & Chr(10)
'	for i=LBound(vParam) to UBound(vParam)
'	    Parametri = Parametri & "  " & vParam(i) & Chr(13) & Chr(10)
'	next
'	MsgBox(Parametri)
'End Function

'Function OnUndoRowsDrop(Nome,vBefore,vParam)
'	On Error Resume Next
'	OnUndoRowsDrop=0
'    Parametri = NomeInterattore & ".OnUndoRowsDrop " & "(" & Nome & "," & vBefore & ",vParam)" & Chr(13) & Chr(10)
'	for i=LBound(vParam) to UBound(vParam)
'	    Parametri = Parametri & "  " & vParam(i) & Chr(13) & Chr(10)
'	next
'	MsgBox(Parametri)
'End Function

'Function OnQueryCommand(Nome)
'	On Error Resume Next
'	OnQueryCommand=0

'	MsgBox(NomeInterattore & ".OnQueryCommand(" & Nome &  ")")

'End Function


